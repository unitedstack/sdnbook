# DHCP

----

## 简介

DHCP 协议全称为"动态主机设置协议"（Dynamic Host Configuration Protocol）。
通常来说，普通电脑中都内置有 DHCP 客户端模块。电脑接上网络后，
DHCP 客户端发现新连通的网络，会在该网络上找 DHCP 服务器。
DHCP 服务器将给电脑提供合理的网络配置，并把设置信息传回本机。
所谓的 DHCP 服务器，其实就是一些运行有 DHCP 服务器端软件的特殊电脑。
他们像等候在网络上的服务员，为新来的顾客排忧解难。本机和 DHCP
服务器之间的通信，都是通过 DHCP 协议进行的。

在网络诞生初期，就有了用一台服务器为网络上的电脑配置参数的做法。
最早的一个协议叫 BOOTP（Bootstrap Protocol），主要用于开机配置。
计算机开机时需要很多配置参数。对于没有磁盘的计算机来说，它无法获得这些参数，
但可以通过 BOOTP 从网络上的其他设备上获得。DHCP 大体上继承了 BOOTP 的工作方
式，但在细节上进行了改进。


## 通信过程

DHCP 协议的底层是 UDP 协议。网络上的点对点沟通需要有 IP 地址。
但新接入网络的客户机正是想通过 DHCP 通信来获得 IP 地址。
这简直成了`鸡生蛋、蛋生鸡`的死胡同。幸好，除了点对点通信，UDP 协议还允许广播通信。
把 UDP 数据包发送到网络的广播地址，网络上的每个设备都能收到。
因此，DHCP 通信主要靠这种广播的形式进行。

DHCP 通信分为四步：

 1. Discovery：客户机发广播，搜寻 DHCP 服务器。
 2. Offer：DHCP 服务器发出邀请，提供一个可用的 IP 地址。
 3. Request：客户机正式请求使用该 IP 地址。
 4. Acknowledge：DHCP 服务器确认，并提供其他配置参数。

 ![dhcp][1]

每一步的通信内容都放在一个符合 DHCP 格式的数据包中。
数据包中可以包括客户机 IP 地址、服务器 IP 地址、客户的硬件 MAC 编号等字段，
还能附加多条网络设置参数。当某些信息未知时，如客户机的 IP 地址，相应的字段可以填成 0 。

[1]: ../../../images/base/dhcp.png
