# 网络层

---

## 简介

以太网协议，依靠 MAC 地址发送数据。理论上，单单依靠 MAC 地址，
不同地域的网卡就可以找到对方了，技术上是可以实现的。
但是，这样做有一个重大的缺点。以太网采用广播方式发送数据包，所有成员都会收到这个数据包，
不仅效率低，而且局限在发送者所在的子网络。
也就是说，如果两台计算机不在同一个子网络，广播是传不过去的。
但是这种设计是合理的，否则互联网上每一台计算机都会收到所有包，那会引起灾难。

因此，必须找到一种方法，能够区分哪些 MAC 地址属于同一个子网络，哪些不是。
如果是同一个子网络，就采用广播方式发送，否则就采用*路由*方式发送。遗憾的是，MAC 地址本身无法做到这一点。它只与厂商有关，与所处网络无关。

这就导致了*网络层*的诞生。它的作用是引进一套新的地址，
使得我们能够区分不同的计算机是否属于同一个子网络。
这套地址就叫做*网络地址*，简称*网址*。

网络层是 [OSI 模型](https://zh.wikipedia.org/wiki/OSI模型)中的第三层。网络层提供路由和寻址的功能，
使两终端系统能够互连且决定最佳路径，并具有一定的拥塞控制和流量控制的能力。
TCP/IP 协议体系中的网络层功能由 IP 协议规定和实现，故又称 IP 层。

## IP 协议

以太网数据包只包含 MAC 地址，并没有 IP 地址的位置。那么是否需要修改数据定义，
再添加一个位置呢？
回答是不需要，把 IP 数据包直接放进以太网数据包的*数据*部分，因此完全不用修改以太网的规格。
这就是互联网分层结构的好处：*上层的变动完全不涉及下层的结构。*
具体来说，IP 数据包也分为*报头*和*数据*两个部分，如下：

 ![ip_header][1]

详细内容如下：

 ![ip_header][7]

*报头* 部分主要包括版本、长度、IP 地址等信息。
*数据* 部分则是 IP 数据包的具体内容。它放进以太网数据包后，以太网数据包就变成
了下面这样：

 ![mac_header][2]



[1]: ../../../images/base/ip_header.png
[2]: ../../../images/base/mac_header.png
[3]: ../../../images/base/arp.png
[4]: ../../../images/base/arp_packet.png
[5]: ../../../images/base/icmp.png
[6]: ../../../images/base/icmp_format.png
[7]: ../../../images/base/ip_ip_header.png
[8]: ../../../images/base/ping.png
